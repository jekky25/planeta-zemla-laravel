import{f as n,o as i,a as d,b as s,u,P as m,g as r,i as f,l as g,d as c,w as v,e as h,F as b,W as _,k as y,n as k,t as l}from"./app-BaH8qqgB.js";import{_ as C}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{M as x}from"./MainLayout-C_1l8-LT.js";const S={props:["sitekey"],methods:{initReCaptcha(){var t=this.$page.props.config.google_recaptcha_key;setTimeout(function(){typeof grecaptcha>"u"?this.initReCaptcha():grecaptcha.ready(function(){grecaptcha.execute(t,{action:"contact"}).then(function(e){var o=document.getElementById("recaptchaResponse");o.value=e})})},100)}},mounted(){document.contains(document.getElementById("recaptcha"))&&document.getElementById("recaptcha").remove();let t=document.createElement("script");t.setAttribute("id","recaptcha"),t.setAttribute("src","https://www.google.com/recaptcha/api.js?render="+this.$page.props.config.google_recaptcha_key),document.head.appendChild(t);var e=this;e.initReCaptcha()}},M=["value"];function j(t,e,o,a,$,p){return i(),n("input",{type:"hidden",name:"recaptcha_response",value:t.$page.props.config.google_recaptcha_key,id:"recaptchaResponse"},null,8,M)}const w=C(S,[["render",j]]),z={id:"comments-form",name:"comments-form",action:"javascript:void(null);"},E=["value"],B=["innerHTML"],L=["innerHTML"],T=["name"],H={id:"comments-form-buttons"},R={class:"btn",id:"comments-form-send"},V={class:"btn",id:"comments-form-cancel",style:{display:"none"}},A=["value"],F={name:"FormAddComment",props:["post"],data(){return{errors:"",success:"",regexpEmail:/^(?:[a-z0-9._]+(?:[-_.]?[a-z0-9._]+)?@[a-z0-9_.-]+(?:\.?[a-z0-9]+)?\.[a-z]{2,5})$/i,id:0,name:"",email:"",message:"",post_id:0,recaptcha_response:"",data:Object}},methods:{JCommentsInitializeForm(t){var e=new JCommentsEditor("comments-form-comment",!0);e.addButton("b","Жирный","Введите текст для форматирования"),e.addButton("i","Курсив","Введите текст для форматирования"),e.addButton("u","Подчеркнутый","Введите текст для форматирования"),e.addButton("s","Зачеркнутый","Введите текст для форматирования"),e.addButton("quote","Цитата","Введите текст цитаты"),e.addButton("custombbcode1","YouTube Video","Введите текст для форматирования","[youtube]","[/youtube]","bbcode-youtube",""),e.addButton("custombbcode4","Google Video","Введите текст для форматирования","[google]","[/google]","bbcode-google",""),e.addButton("custombbcode8","Facebook Video","Введите текст для форматирования","[fv]","[/fv]","bbcode-facebook",""),e.addButton("custombbcode10","Wikipedia","Введите текст для форматирования","[wiki]","[/wiki]","bbcode-wiki",""),e.initSmiles("/images/smiles"),e.addSmile(":D","laugh.gif"),e.addSmile(":lol:","lol.gif"),e.addSmile(":-)","smile.gif"),e.addSmile(";-)","wink.gif"),e.addSmile("8)","cool.gif"),e.addSmile(":-|","normal.gif"),e.addSmile(":-*","whistling.gif"),e.addSmile(":oops:","redface.gif"),e.addSmile(":sad:","sad.gif"),e.addSmile(":cry:","cry.gif"),e.addSmile(":o","surprised.gif"),e.addSmile(":-?","confused.gif"),e.addSmile(":-x","sick.gif"),e.addSmile(":eek:","shocked.gif"),e.addSmile(":zzz","sleeping.gif"),e.addSmile(":P","tongue.gif"),e.addSmile(":roll:","rolleyes.gif"),e.addSmile(":sigh:","unsure.gif"),e.addCounter(1e3,"Осталось:"," символов","counter"),t.setForm(new JCommentsForm("comments-form",e))},clearParams(){this.$data.errors="",this.$data.success=""},reloadCaptcha(){this.$refs.googleCaptcha.initReCaptcha()},saveComment(){return this.clearParams(),this.checkName(),this.checkEMail(),this.checkMessage(),this.isError()||(this.getData(),this.sendAjax()),!1},checkName(){this.name.length<2&&(this.$data.errors+="<p>Имя не введено</p>")},checkEMail(){this.email.match(this.$data.regexpEmail)||(this.$data.errors+="<p>Некорректно введен е-майл</p>")},checkMessage(){this.message.length<2&&(this.$data.errors+="<p>Не введено сообщение</p>")},isError(){return this.$data.errors!=""},getData(){this.$data.name=this.name,this.$data.email=this.email,this.$data.message=document.getElementById("comments-form-comment").value,this.$data._token=this.csrf_field,this.$data.post_id=this.post.id,this.recaptcha_response=document.getElementById("recaptchaResponse").value},sendAjax(){return axios.post(route("comment.store",this.$data)).then(t=>{let e=t.data.success;_.reload(),e==1&&(this.success="<p>Спасибо! Сообщение успешно добавлено!</p>",this.reloadCaptcha())}).catch(t=>{this.$data.errors+="<p>"+t.response.data.message+"</p>",this.reloadCaptcha()}),!1}},mounted(){var t=new JComments(this.post.id,"com_content",route("comment.ajax"));t.setList("comments-list"),this.JCommentsInitializeForm(t)}},I=Object.assign(F,{setup(t){return(e,o)=>(i(),n(b,null,[d(u(m),{id:"addcomments",href:"#addcomments"}),s("form",z,[s("input",{type:"hidden",name:"_token",autocomplete:"off",value:e.$attrs.csrf_field},null,8,E),e.success?(i(),n("div",{key:0,class:"success-text",innerHTML:e.success},null,8,B)):r("",!0),e.errors?(i(),n("div",{key:1,class:"error-text",innerHTML:e.errors},null,8,L)):r("",!0),d(w,{ref:"googleCaptcha"},null,512),s("p",null,[f(s("input",{"onUpdate:modelValue":o[0]||(o[0]=a=>e.name=a),id:"comments-form-name",type:"text",name:"name",value:"",maxlength:"20",size:"22",tabindex:"1",class:""},null,512),[[g,e.name]]),o[4]||(o[4]=s("label",{for:"comments-form-name"},"Имя (обязательное)",-1))]),s("p",null,[f(s("input",{"onUpdate:modelValue":o[1]||(o[1]=a=>e.email=a),id:"comments-form-email",type:"text",name:"email",value:"",size:"22",tabindex:"2"},null,512),[[g,e.email]]),o[5]||(o[5]=s("label",{for:"comments-form-email"},"E-Mail (обязательное)",-1))]),s("p",null,[f(s("textarea",{"onUpdate:modelValue":o[2]||(o[2]=a=>e.message=a),id:"comments-form-comment",name:e.message,cols:"65",rows:"8",tabindex:"5"},null,8,T),[[g,e.message]])]),s("div",H,[s("div",R,[s("div",null,[s("a",{href:"#",tabindex:"7",onClick:o[3]||(o[3]=c(a=>{e.saveComment()},["prevent"])),title:"Отправить (Ctrl+Enter)"},"Отправить")])]),s("div",V,[s("div",null,[d(u(m),{href:"#",tabindex:"8",onclick:"return false;",title:"Отменить"},{default:v(()=>o[6]||(o[6]=[h("Отменить")])),_:1})])]),o[7]||(o[7]=s("div",{style:{clear:"both"}},null,-1))]),s("input",{type:"hidden",name:"object_id",value:t.post.id},null,8,A),o[8]||(o[8]=s("input",{type:"hidden",name:"object_group",value:"com_content"},null,-1))])],64))}}),N={key:0,id:"jc"},P={id:"comments"},q=["href"],D={id:"comments-list",class:"comments-list"},J=["id"],O={class:"rbox"},U={class:"rbox_m"},W={class:"comment-box usertype-guest"},G={class:"comments-vote"},Y=["id"],K=["onClick"],Q=["onClick"],X={class:"comment-author"},Z={class:"comment-date"},ee=["id","innerHTML"],te={class:"comments-buttons"},se=["onClick"],oe={id:"comments-list-footer"},ae=["href"],ne={name:"Comments",props:["post"],data(){return{errors:"",success:"",regexpEmail:/^(?:[a-z0-9._]+(?:[-_.]?[a-z0-9._]+)?@[a-z0-9_.-]+(?:\.?[a-z0-9]+)?\.[a-z]{2,5})$/i,id:0,name:"",email:"",message:"",post_id:0,recaptcha_response:"",data:Object}},methods:{voteComment(t,e){let o={vote:e};return axios.patch(route("post.update",{id:t}),o).then(a=>{_.reload(),this.$refs.formAddComment.reloadCaptcha()}).catch(a=>{this.errors=a.data}),!1},async ajax(t){let e;return await axios.get(t).then(o=>{e=o.data}).catch(o=>{this.$data.errors+="<p>"+o.response.data.message+"</p>"}),e},async quoteComment(t){let e=await this.ajax(route("comment.id.ajax",t)),o=this.$refs.formAddComment.message.length==0?"":`
`;o+="[quote]"+e.text+`[/quote]
`,this.$refs.formAddComment.message+=o}}},ie=Object.assign(ne,{setup(t){return(e,o)=>t.post.comments?(i(),n("div",N,[s("div",P,[s("h4",null,[o[0]||(o[0]=h("Комментарии ")),s("a",{class:"rss",href:e.route("comment.rss",[t.post.category.slug,t.post.id,t.post.slug]),title:"RSS лента комментариев этой записи",target:"_blank"}," ",8,q)]),s("div",D,[(i(!0),n(b,null,y(t.post.comments,(a,$)=>(i(),n("div",{class:"even",id:`comment-item-${a.id}`},[s("div",O,[o[2]||(o[2]=s("div",{class:"rbox_tr"},[s("div",{class:"rbox_tl"},[s("div",{class:"rbox_t"}," ")])],-1)),s("div",U,[s("div",W,[s("span",G,[s("span",{id:`comment-vote-holder-${a.id}`},[a.votes?(i(),n("a",{key:0,href:"#",class:"vote-good",title:"Хороший комментарий!",onClick:c(p=>{e.voteComment(a.id,1)},["prevent"])},null,8,K)):r("",!0),a.votes?(i(),n("a",{key:1,href:"#",class:"vote-poor",title:"Плохой комментарий!",onClick:c(p=>{e.voteComment(a.id,-1)},["prevent"])},null,8,Q)):r("",!0),s("span",{class:k(a.voteClass)},l(a.voteCount),3)],8,Y)]),d(u(m),{class:"comment-anchor",href:`${e.route("item.name",[t.post.category.slug,t.post.id,t.post.slug])}#comment-${t.post.id}`,id:`comment-${t.post.id}`},{default:v(()=>[h("#"+l($),1)]),_:2},1032,["href","id"]),s("span",X,l(a.name),1),s("span",Z,l(a.date),1),s("div",{class:"comment-body",id:`comment-body-${a.id}`,innerHTML:a.text},null,8,ee),s("span",te,[s("a",{href:"#",onClick:c(p=>{e.quoteComment(a.id)},["prevent"])},"Цитировать",8,se)])]),o[1]||(o[1]=s("div",{class:"clear"},null,-1))]),o[3]||(o[3]=s("div",{class:"rbox_br"},[s("div",{class:"rbox_bl"},[s("div",{class:"rbox_b"}," ")])],-1))])],8,J))),256))]),s("div",oe,[s("a",{class:"rss",href:e.route("comment.rss",[t.post.category.slug,t.post.id,t.post.slug]),target:"_blank"},"RSS лента комментариев этой записи",8,ae)])]),d(I,{ref:"formAddComment",post:t.post},null,8,["post"])])):r("",!0)}}),de={key:0,class:"contentheading"},re={class:"article-content"},le=["innerHTML"],me=["innerHTML"],ce={name:"Page",components:{Link:m},layout:x,props:["post"]},fe=Object.assign(ce,{setup(t){return(e,o)=>t.post?(i(),n(b,{key:0},[o[0]||(o[0]=s("div",{class:"componentheading"},null,-1)),t.post.category?(i(),n("h2",de,[d(u(m),{href:e.route("item.name",[t.post.category.slug,t.post.id,t.post.slug]),class:"contentpagetitle"},{default:v(()=>[h(l(t.post.title),1)]),_:1},8,["href"])])):r("",!0),s("div",re,[s("span",{innerHTML:t.post.introtext},null,8,le),s("span",{innerHTML:t.post.fulltext},null,8,me)]),d(ie,{post:t.post},null,8,["post"])],64)):r("",!0)}});export{fe as default};
