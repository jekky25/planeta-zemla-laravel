import{M as S}from"./MainLayout-DjohslSZ.js";import{l as p,f as i,o as d,a as l,b as t,g as m,i as _,k as b,d as f,w as C,e as g,F as k,W as x,q as M,n as z,t as u,u as L,P as y}from"./app-CXY6ZZGz.js";import{G as j}from"./GoogleCaptcha-kB3qBKeg.js";import{_ as $}from"./_plugin-vue_export-helper-DlAUqK2U.js";const w={name:"FormAddComment",props:["post"],components:{GoogleCaptcha:j},data(){return{errors:"",success:"",regexpEmail:/^(?:[a-z0-9._]+(?:[-_.]?[a-z0-9._]+)?@[a-z0-9_.-]+(?:\.?[a-z0-9]+)?\.[a-z]{2,5})$/i,id:0,name:"",email:"",message:"",post_id:0,recaptcha_response:"",data:Object}},methods:{JCommentsInitializeForm(s){var e=new JCommentsEditor("comments-form-comment",!0);e.addButton("b","Жирный","Введите текст для форматирования"),e.addButton("i","Курсив","Введите текст для форматирования"),e.addButton("u","Подчеркнутый","Введите текст для форматирования"),e.addButton("s","Зачеркнутый","Введите текст для форматирования"),e.addButton("quote","Цитата","Введите текст цитаты"),e.addButton("custombbcode1","YouTube Video","Введите текст для форматирования","[youtube]","[/youtube]","bbcode-youtube",""),e.addButton("custombbcode4","Google Video","Введите текст для форматирования","[google]","[/google]","bbcode-google",""),e.addButton("custombbcode8","Facebook Video","Введите текст для форматирования","[fv]","[/fv]","bbcode-facebook",""),e.addButton("custombbcode10","Wikipedia","Введите текст для форматирования","[wiki]","[/wiki]","bbcode-wiki",""),e.initSmiles("/images/smiles"),e.addSmile(":D","laugh.gif"),e.addSmile(":lol:","lol.gif"),e.addSmile(":-)","smile.gif"),e.addSmile(";-)","wink.gif"),e.addSmile("8)","cool.gif"),e.addSmile(":-|","normal.gif"),e.addSmile(":-*","whistling.gif"),e.addSmile(":oops:","redface.gif"),e.addSmile(":sad:","sad.gif"),e.addSmile(":cry:","cry.gif"),e.addSmile(":o","surprised.gif"),e.addSmile(":-?","confused.gif"),e.addSmile(":-x","sick.gif"),e.addSmile(":eek:","shocked.gif"),e.addSmile(":zzz","sleeping.gif"),e.addSmile(":P","tongue.gif"),e.addSmile(":roll:","rolleyes.gif"),e.addSmile(":sigh:","unsure.gif"),e.addCounter(1e3,"Осталось:"," символов","counter"),s.setForm(new JCommentsForm("comments-form",e))},clearParams(){this.$data.errors="",this.$data.success=""},reloadCaptcha(){this.$refs.googleCaptcha.initReCaptcha()},saveComment(){return this.clearParams(),this.checkName(),this.checkEMail(),this.checkMessage(),this.isError()||(this.getData(),this.sendAjax()),!1},checkName(){this.name.length<2&&(this.$data.errors+="<p>Имя не введено</p>")},checkEMail(){this.email.match(this.$data.regexpEmail)||(this.$data.errors+="<p>Некорректно введен е-майл</p>")},checkMessage(){this.message.length<2&&(this.$data.errors+="<p>Не введено сообщение</p>")},isError(){return this.$data.errors!=""},getData(){this.$data.name=this.name,this.$data.email=this.email,this.$data.message=document.getElementById("comments-form-comment").value,this.$data._token=this.csrf_field,this.$data.post_id=this.post.id,this.recaptcha_response=document.getElementById("recaptchaResponse").value},sendAjax(){return axios.post(route("comment.store",this.$data)).then(s=>{let e=s.data.success;x.reload(),e==1&&(this.success="<p>Спасибо! Сообщение успешно добавлено!</p>",this.reloadCaptcha())}).catch(s=>{this.$data.errors+="<p>"+s.response.data.message+"</p>",this.reloadCaptcha()}),!1}},mounted(){var s=new JComments(this.post.id,"com_content",route("comment.ajax"));s.setList("comments-list"),this.JCommentsInitializeForm(s)}},B={id:"comments-form",name:"comments-form",action:"javascript:void(null);"},E=["value"],T=["innerHTML"],H=["innerHTML"],V=["name"],F={id:"comments-form-buttons"},A={class:"btn",id:"comments-form-send"},P={class:"btn",id:"comments-form-cancel",style:{display:"none"}},q=["value"];function N(s,e,o,n,a,c){const h=p("Link"),v=p("GoogleCaptcha");return d(),i(k,null,[l(h,{id:"addcomments",href:"#addcomments"}),t("form",B,[t("input",{type:"hidden",name:"_token",autocomplete:"off",value:s.$attrs.csrf_field},null,8,E),a.success?(d(),i("div",{key:0,class:"success-text",innerHTML:a.success},null,8,T)):m("",!0),a.errors?(d(),i("div",{key:1,class:"error-text",innerHTML:a.errors},null,8,H)):m("",!0),l(v,{ref:"googleCaptcha"},null,512),t("p",null,[_(t("input",{"onUpdate:modelValue":e[0]||(e[0]=r=>a.name=r),id:"comments-form-name",type:"text",name:"name",value:"",maxlength:"20",size:"22",tabindex:"1",class:""},null,512),[[b,a.name]]),e[4]||(e[4]=t("label",{for:"comments-form-name"},"Имя (обязательное)",-1))]),t("p",null,[_(t("input",{"onUpdate:modelValue":e[1]||(e[1]=r=>a.email=r),id:"comments-form-email",type:"text",name:"email",value:"",size:"22",tabindex:"2"},null,512),[[b,a.email]]),e[5]||(e[5]=t("label",{for:"comments-form-email"},"E-Mail (обязательное)",-1))]),t("p",null,[_(t("textarea",{"onUpdate:modelValue":e[2]||(e[2]=r=>a.message=r),id:"comments-form-comment",name:a.message,cols:"65",rows:"8",tabindex:"5"},null,8,V),[[b,a.message]])]),t("div",F,[t("div",A,[t("div",null,[t("a",{href:"#",tabindex:"7",onClick:e[3]||(e[3]=f(r=>{c.saveComment()},["prevent"])),title:"Отправить (Ctrl+Enter)"},"Отправить")])]),t("div",P,[t("div",null,[l(h,{href:"#",tabindex:"8",onclick:"return false;",title:"Отменить"},{default:C(()=>e[6]||(e[6]=[g("Отменить")])),_:1})])]),e[7]||(e[7]=t("div",{style:{clear:"both"}},null,-1))]),t("input",{type:"hidden",name:"object_id",value:o.post.id},null,8,q),e[8]||(e[8]=t("input",{type:"hidden",name:"object_group",value:"com_content"},null,-1))])],64)}const D=$(w,[["render",N]]),G={key:0,id:"jc"},J={id:"comments"},I=["href"],R={id:"comments-list",class:"comments-list"},O=["id"],U={class:"rbox"},W={class:"rbox_m"},Y={class:"comment-box usertype-guest"},K={class:"comments-vote"},Q=["id"],X=["onClick"],Z=["onClick"],ee={class:"comment-author"},te={class:"comment-date"},se=["id","innerHTML"],oe={class:"comments-buttons"},ne=["onClick"],ae={id:"comments-list-footer"},ie=["href"],de={name:"Comments",props:["post"],data(){return{errors:"",success:"",regexpEmail:/^(?:[a-z0-9._]+(?:[-_.]?[a-z0-9._]+)?@[a-z0-9_.-]+(?:\.?[a-z0-9]+)?\.[a-z]{2,5})$/i,id:0,name:"",email:"",message:"",post_id:0,recaptcha_response:"",data:Object}},methods:{voteComment(s,e){let o={vote:e};return axios.patch(route("post.update",{id:s}),o).then(n=>{x.reload(),this.$refs.formAddComment.reloadCaptcha()}).catch(n=>{this.errors=n.data}),!1},async ajax(s){let e;return await axios.get(s).then(o=>{e=o.data}).catch(o=>{this.$data.errors+="<p>"+o.response.data.message+"</p>"}),e},async quoteComment(s){let e=await this.ajax(route("comment.id.ajax",s)),o=this.$refs.formAddComment.message.length==0?"":`
`;o+="[quote]"+e.text+`[/quote]
`,this.$refs.formAddComment.message+=o}}},le=Object.assign(de,{setup(s){return(e,o)=>s.post.comments?(d(),i("div",G,[t("div",J,[t("h4",null,[o[0]||(o[0]=g("Комментарии ")),t("a",{class:"rss",href:e.route("comment.rss",[s.post.category.slug,s.post.id,s.post.slug]),title:"RSS лента комментариев этой записи",target:"_blank"}," ",8,I)]),t("div",R,[(d(!0),i(k,null,M(s.post.comments,(n,a)=>(d(),i("div",{class:"even",id:`comment-item-${n.id}`},[t("div",U,[o[2]||(o[2]=t("div",{class:"rbox_tr"},[t("div",{class:"rbox_tl"},[t("div",{class:"rbox_t"}," ")])],-1)),t("div",W,[t("div",Y,[t("span",K,[t("span",{id:`comment-vote-holder-${n.id}`},[n.votes?(d(),i("a",{key:0,href:"#",class:"vote-good",title:"Хороший комментарий!",onClick:f(c=>{e.voteComment(n.id,1)},["prevent"])},null,8,X)):m("",!0),n.votes?(d(),i("a",{key:1,href:"#",class:"vote-poor",title:"Плохой комментарий!",onClick:f(c=>{e.voteComment(n.id,-1)},["prevent"])},null,8,Z)):m("",!0),t("span",{class:z(n.voteClass)},u(n.voteCount),3)],8,Q)]),l(L(y),{class:"comment-anchor",href:`${e.route("item.name",[s.post.category.slug,s.post.id,s.post.slug])}#comment-${s.post.id}`,id:`comment-${s.post.id}`},{default:C(()=>[g("#"+u(a),1)]),_:2},1032,["href","id"]),t("span",ee,u(n.name),1),t("span",te,u(n.date),1),t("div",{class:"comment-body",id:`comment-body-${n.id}`,innerHTML:n.text},null,8,se),t("span",oe,[t("a",{href:"#",onClick:f(c=>{e.quoteComment(n.id)},["prevent"])},"Цитировать",8,ne)])]),o[1]||(o[1]=t("div",{class:"clear"},null,-1))]),o[3]||(o[3]=t("div",{class:"rbox_br"},[t("div",{class:"rbox_bl"},[t("div",{class:"rbox_b"}," ")])],-1))])],8,O))),256))]),t("div",ae,[t("a",{class:"rss",href:e.route("comment.rss",[s.post.category.slug,s.post.id,s.post.slug]),target:"_blank"},"RSS лента комментариев этой записи",8,ie)])]),l(D,{ref:"formAddComment",post:s.post},null,8,["post"])])):m("",!0)}}),me={name:"Page",components:{Link:y,Comments:le},layout:S,props:["post"]},re={key:0,class:"contentheading"},ce={class:"article-content"},ue=["innerHTML"],he=["innerHTML"];function fe(s,e,o,n,a,c){const h=p("Link"),v=p("Comments");return o.post?(d(),i(k,{key:0},[e[0]||(e[0]=t("div",{class:"componentheading"},null,-1)),o.post.category?(d(),i("h2",re,[l(h,{href:s.route("item.name",[o.post.category.slug,o.post.id,o.post.slug]),class:"contentpagetitle"},{default:C(()=>[g(u(o.post.title),1)]),_:1},8,["href"])])):m("",!0),t("div",ce,[t("span",{innerHTML:o.post.introtext},null,8,ue),t("span",{innerHTML:o.post.fulltext},null,8,he)]),l(v,{post:o.post},null,8,["post"])],64)):m("",!0)}const be=$(me,[["render",fe]]);export{be as default};
