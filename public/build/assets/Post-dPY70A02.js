import{f as i,o as n,a as d,b as t,u,P as l,g as r,i as p,l as f,d as g,w as h,e as c,F as v,W as _,k,n as y,t as m}from"./app-BRQczbWr.js";import{_ as C}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{M as S}from"./MainLayout-BNvXa1S1.js";const x={props:["sitekey"],methods:{initReCaptcha(){var s=this.$page.props.config.google_recaptcha_key;setTimeout(function(){typeof grecaptcha>"u"?this.initReCaptcha():grecaptcha.ready(function(){grecaptcha.execute(s,{action:"contact"}).then(function(e){var o=document.getElementById("recaptchaResponse");o.value=e})})},100)}},mounted(){document.contains(document.getElementById("recaptcha"))&&document.getElementById("recaptcha").remove();let s=document.createElement("script");s.setAttribute("id","recaptcha"),s.setAttribute("src","https://www.google.com/recaptcha/api.js?render="+this.$page.props.config.google_recaptcha_key),document.head.appendChild(s);var e=this;e.initReCaptcha()}},M=["value"];function z(s,e,o,a,b,$){return n(),i("input",{type:"hidden",name:"recaptcha_response",value:s.$page.props.config.google_recaptcha_key,id:"recaptchaResponse"},null,8,M)}const E=C(x,[["render",z]]),j={id:"comments-form",name:"comments-form",action:"javascript:void(null);"},w=["value"],B=["innerHTML"],L=["innerHTML"],T={id:"comments-form-buttons"},H={class:"btn",id:"comments-form-send"},R={class:"btn",id:"comments-form-cancel",style:{display:"none"}},V=["value"],F={name:"FormAddComment",props:["post"],data(){return{errors:"",success:"",regexpEmail:/^(?:[a-z0-9._]+(?:[-_.]?[a-z0-9._]+)?@[a-z0-9_.-]+(?:\.?[a-z0-9]+)?\.[a-z]{2,5})$/i,id:0,name:"",email:"",message:"",post_id:0,recaptcha_response:"",data:Object}},methods:{JCommentsInitializeForm(s){var e=new JCommentsEditor("comments-form-comment",!0);e.addButton("b","Жирный","Введите текст для форматирования"),e.addButton("i","Курсив","Введите текст для форматирования"),e.addButton("u","Подчеркнутый","Введите текст для форматирования"),e.addButton("s","Зачеркнутый","Введите текст для форматирования"),e.addButton("quote","Цитата","Введите текст цитаты"),e.addButton("custombbcode1","YouTube Video","Введите текст для форматирования","[youtube]","[/youtube]","bbcode-youtube",""),e.addButton("custombbcode4","Google Video","Введите текст для форматирования","[google]","[/google]","bbcode-google",""),e.addButton("custombbcode8","Facebook Video","Введите текст для форматирования","[fv]","[/fv]","bbcode-facebook",""),e.addButton("custombbcode10","Wikipedia","Введите текст для форматирования","[wiki]","[/wiki]","bbcode-wiki",""),e.initSmiles("/images/smilies"),e.addSmile(":D","laugh.gif"),e.addSmile(":lol:","lol.gif"),e.addSmile(":-)","smile.gif"),e.addSmile(";-)","wink.gif"),e.addSmile("8)","cool.gif"),e.addSmile(":-|","normal.gif"),e.addSmile(":-*","whistling.gif"),e.addSmile(":oops:","redface.gif"),e.addSmile(":sad:","sad.gif"),e.addSmile(":cry:","cry.gif"),e.addSmile(":o","surprised.gif"),e.addSmile(":-?","confused.gif"),e.addSmile(":-x","sick.gif"),e.addSmile(":eek:","shocked.gif"),e.addSmile(":zzz","sleeping.gif"),e.addSmile(":P","tongue.gif"),e.addSmile(":roll:","rolleyes.gif"),e.addSmile(":sigh:","unsure.gif"),e.addCounter(1e3,"Осталось:"," символов","counter"),s.setForm(new JCommentsForm("comments-form",e))},clearParams(){this.$data.errors="",this.$data.success=""},reloadCaptcha(){this.$refs.googleCaptcha.initReCaptcha()},saveComment(){return this.clearParams(),this.checkName(),this.checkEMail(),this.checkMessage(),this.isError()||(this.getData(),this.sendAjax()),!1},checkName(){this.name.length<2&&(this.$data.errors+="<p>Имя не введено</p>")},checkEMail(){this.email.match(this.$data.regexpEmail)||(this.$data.errors+="<p>Некорректно введен е-майл</p>")},checkMessage(){this.message.length<2&&(this.$data.errors+="<p>Не введено сообщение</p>")},isError(){return this.$data.errors!=""},getData(){this.$data.name=this.name,this.$data.email=this.email,alert(this.message),this.$data.message=this.message,this.$data._token=this.csrf_field,this.$data.post_id=this.post.id,this.recaptcha_response=document.getElementById("recaptchaResponse").value},sendAjax(){return axios.post(route("comment.store",this.$data)).then(s=>{let e=s.data.success;_.reload(),e==1&&(this.success="<p>Спасибо! Сообщение успешно добавлено!</p>",this.reloadCaptcha())}).catch(s=>{this.$data.errors+="<p>"+s.response.data.message+"</p>",this.reloadCaptcha()}),!1}},mounted(){var s=new JComments(this.post.id,"com_content",route("comment.ajax"));s.setList("comments-list"),this.JCommentsInitializeForm(s)}},A=Object.assign(F,{setup(s){return(e,o)=>(n(),i(v,null,[d(u(l),{id:"addcomments",href:"#addcomments"}),t("form",j,[t("input",{type:"hidden",name:"_token",autocomplete:"off",value:e.$attrs.csrf_field},null,8,w),e.success?(n(),i("div",{key:0,class:"success-text",innerHTML:e.success},null,8,B)):r("",!0),e.errors?(n(),i("div",{key:1,class:"error-text",innerHTML:e.errors},null,8,L)):r("",!0),d(E,{ref:"googleCaptcha"},null,512),t("p",null,[p(t("input",{"onUpdate:modelValue":o[0]||(o[0]=a=>e.name=a),id:"comments-form-name",type:"text",name:"name",value:"",maxlength:"20",size:"22",tabindex:"1",class:""},null,512),[[f,e.name]]),o[4]||(o[4]=t("label",{for:"comments-form-name"},"Имя (обязательное)",-1))]),t("p",null,[p(t("input",{"onUpdate:modelValue":o[1]||(o[1]=a=>e.email=a),id:"comments-form-email",type:"text",name:"email",value:"",size:"22",tabindex:"2"},null,512),[[f,e.email]]),o[5]||(o[5]=t("label",{for:"comments-form-email"},"E-Mail (обязательное)",-1))]),t("p",null,[p(t("textarea",{"onUpdate:modelValue":o[2]||(o[2]=a=>e.message=a),id:"comments-form-comment",name:"message",cols:"65",rows:"8",tabindex:"5"},null,512),[[f,e.message]])]),t("div",T,[t("div",H,[t("div",null,[t("a",{href:"#",tabindex:"7",onClick:o[3]||(o[3]=g(a=>{e.saveComment()},["prevent"])),title:"Отправить (Ctrl+Enter)"},"Отправить")])]),t("div",R,[t("div",null,[d(u(l),{href:"#",tabindex:"8",onclick:"return false;",title:"Отменить"},{default:h(()=>o[6]||(o[6]=[c("Отменить")])),_:1})])]),o[7]||(o[7]=t("div",{style:{clear:"both"}},null,-1))]),t("input",{type:"hidden",name:"object_id",value:s.post.id},null,8,V),o[8]||(o[8]=t("input",{type:"hidden",name:"object_group",value:"com_content"},null,-1))])],64))}}),I={key:0,id:"jc"},N={id:"comments"},P=["href"],D={id:"comments-list",class:"comments-list"},J=["id"],O={class:"rbox"},U={class:"rbox_m"},W={class:"comment-box usertype-guest"},q={class:"comments-vote"},G=["id"],Y=["onClick"],K=["onClick"],Q={class:"comment-author"},X={class:"comment-date"},Z=["id","innerHTML"],ee={class:"comments-buttons"},te={id:"comments-list-footer"},se=["href"],oe={name:"Comments",props:["post"],data(){return{errors:"",success:"",regexpEmail:/^(?:[a-z0-9._]+(?:[-_.]?[a-z0-9._]+)?@[a-z0-9_.-]+(?:\.?[a-z0-9]+)?\.[a-z]{2,5})$/i,id:0,name:"",email:"",message:"",post_id:0,recaptcha_response:"",data:Object}},methods:{voteComment(s,e){let o={vote:e};return axios.patch(route("post.update",{id:s}),o).then(a=>{_.reload(),this.$refs.formAddComment.reloadCaptcha()}).catch(a=>{this.errors=a.data}),!1}}},ae=Object.assign(oe,{setup(s){return(e,o)=>s.post.comments?(n(),i("div",I,[t("div",N,[t("h4",null,[o[0]||(o[0]=c("Комментарии ")),t("a",{class:"rss",href:e.route("comment.rss",[s.post.category.slug,s.post.id,s.post.slug]),title:"RSS лента комментариев этой записи",target:"_blank"}," ",8,P)]),t("div",D,[(n(!0),i(v,null,k(s.post.comments,(a,b)=>(n(),i("div",{class:"even",id:`comment-item-${a.id}`},[t("div",O,[o[3]||(o[3]=t("div",{class:"rbox_tr"},[t("div",{class:"rbox_tl"},[t("div",{class:"rbox_t"}," ")])],-1)),t("div",U,[t("div",W,[t("span",q,[t("span",{id:`comment-vote-holder-${a.id}`},[a.votes?(n(),i("a",{key:0,href:"#",class:"vote-good",title:"Хороший комментарий!",onClick:g($=>{e.voteComment(a.id,1)},["prevent"])},null,8,Y)):r("",!0),a.votes?(n(),i("a",{key:1,href:"#",class:"vote-poor",title:"Плохой комментарий!",onClick:g($=>{e.voteComment(a.id,-1)},["prevent"])},null,8,K)):r("",!0),t("span",{class:y(a.voteClass)},m(a.voteCount),3)],8,G)]),d(u(l),{class:"comment-anchor",href:`${e.route("item.name",[s.post.category.slug,s.post.id,s.post.slug])}#comment-${s.post.id}`,id:`comment-${s.post.id}`},{default:h(()=>[c("#"+m(b),1)]),_:2},1032,["href","id"]),t("span",Q,m(a.name),1),t("span",X,m(a.date),1),t("div",{class:"comment-body",id:`comment-body-${a.id}`,innerHTML:a.text},null,8,Z),t("span",ee,[d(u(l),{href:"#",onclick:`jcomments.quoteComment(${a.id}); return false;`},{default:h(()=>o[1]||(o[1]=[c("Цитировать")])),_:2},1032,["onclick"])])]),o[2]||(o[2]=t("div",{class:"clear"},null,-1))]),o[4]||(o[4]=t("div",{class:"rbox_br"},[t("div",{class:"rbox_bl"},[t("div",{class:"rbox_b"}," ")])],-1))])],8,J))),256))]),t("div",te,[t("a",{class:"rss",href:e.route("comment.rss",[s.post.category.slug,s.post.id,s.post.slug]),target:"_blank"},"RSS лента комментариев этой записи",8,se)])]),d(A,{ref:"formAddComment",post:s.post},null,8,["post"])])):r("",!0)}}),ie={key:0,class:"contentheading"},ne={class:"article-content"},de=["innerHTML"],re=["innerHTML"],le={name:"Page",components:{Link:l},layout:S,props:["post"]},he=Object.assign(le,{setup(s){return(e,o)=>s.post?(n(),i(v,{key:0},[o[0]||(o[0]=t("div",{class:"componentheading"},null,-1)),s.post.category?(n(),i("h2",ie,[d(u(l),{href:e.route("item.name",[s.post.category.slug,s.post.id,s.post.slug]),class:"contentpagetitle"},{default:h(()=>[c(m(s.post.title),1)]),_:1},8,["href"])])):r("",!0),t("div",ne,[t("span",{innerHTML:s.post.introtext},null,8,de),t("span",{innerHTML:s.post.fulltext},null,8,re)]),d(ae,{post:s.post},null,8,["post"])],64)):r("",!0)}});export{he as default};
