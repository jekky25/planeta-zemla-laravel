import{M as L}from"./MainLayout-vZoVWs3c.js";import{j as r,f as i,o as d,a,b as s,g as u,w as c,e as l,d as _,F as b,W as k,l as j,n as B,t as p,u as V,P as y}from"./app-C5ocI1KK.js";import{c as M,a as T,b as w,L as z,d as E,S as H,G as F}from"./ajax-DVjCZfLM.js";import{_ as $}from"./_plugin-vue_export-helper-DlAUqK2U.js";const I={name:"FormAddComment",props:["post"],components:{GoogleCaptcha:F,SubmitButton:H,LabelInput:E,LabelTextarea:z},data(){return{id:0,name:"",email:"",message:"",post_id:0,recaptcha_response:"",data:Object}},mixins:[M,T,w],methods:{JCommentsInitializeForm(t){var e=new JCommentsEditor("comments-form-comment",!0);e.addButton("b","Жирный","Введите текст для форматирования"),e.addButton("i","Курсив","Введите текст для форматирования"),e.addButton("u","Подчеркнутый","Введите текст для форматирования"),e.addButton("s","Зачеркнутый","Введите текст для форматирования"),e.addButton("quote","Цитата","Введите текст цитаты"),e.addButton("custombbcode1","YouTube Video","Введите текст для форматирования","[youtube]","[/youtube]","bbcode-youtube",""),e.addButton("custombbcode4","Google Video","Введите текст для форматирования","[google]","[/google]","bbcode-google",""),e.addButton("custombbcode8","Facebook Video","Введите текст для форматирования","[fv]","[/fv]","bbcode-facebook",""),e.addButton("custombbcode10","Wikipedia","Введите текст для форматирования","[wiki]","[/wiki]","bbcode-wiki",""),e.initSmiles("/images/smiles"),e.addSmile(":D","laugh.gif"),e.addSmile(":lol:","lol.gif"),e.addSmile(":-)","smile.gif"),e.addSmile(";-)","wink.gif"),e.addSmile("8)","cool.gif"),e.addSmile(":-|","normal.gif"),e.addSmile(":-*","whistling.gif"),e.addSmile(":oops:","redface.gif"),e.addSmile(":sad:","sad.gif"),e.addSmile(":cry:","cry.gif"),e.addSmile(":o","surprised.gif"),e.addSmile(":-?","confused.gif"),e.addSmile(":-x","sick.gif"),e.addSmile(":eek:","shocked.gif"),e.addSmile(":zzz","sleeping.gif"),e.addSmile(":P","tongue.gif"),e.addSmile(":roll:","rolleyes.gif"),e.addSmile(":sigh:","unsure.gif"),e.addCounter(1e3,"Осталось:"," символов","counter"),t.setForm(new JCommentsForm("comments-form",e))},saveComment(){return this.clearParams(),this.checkName(this.$refs.name.get()),this.checkEMail(this.$refs.email.get()),this.checkMessage(this.$refs.message.get()),this.isError()||(this.getData(),this.ajax(route("comment.store",this.$data))),!1},getData(){this.$data.name=this.$refs.name.get(),this.$data.email=this.$refs.email.get(),this.$data.message=document.getElementById("comments-form-comment").value,this.$data._token=this.csrf_field,this.$data.post_id=this.post.id,this.recaptcha_response=document.getElementById("recaptchaResponse").value},ajaxError(t){this.$data.errors+="<p>"+t.response.data.message+"</p>",this.reloadCaptcha()},ajaxSuccess(t){let e=t.data.success;k.reload(),e==1&&(this.success="<p>Спасибо! Сообщение успешно добавлено!</p>",this.reloadCaptcha())}},mounted(){var t=new JComments(this.post.id,"com_content",route("comment.ajax"));t.setList("comments-list"),this.JCommentsInitializeForm(t)}},A={id:"comments-form",name:"comments-form",action:"javascript:void(null);"},P=["value"],q=["innerHTML"],G=["innerHTML"],J={id:"comments-form-buttons"},N={class:"btn",id:"comments-form-send"},D={class:"btn",id:"comments-form-cancel",style:{display:"none"}},O=["value"];function R(t,e,o,n,m,h){const g=r("Link"),v=r("GoogleCaptcha"),C=r("LabelInput"),x=r("LabelTextarea"),S=r("SubmitButton");return d(),i(b,null,[a(g,{id:"addcomments",href:"#addcomments"}),s("form",A,[s("input",{type:"hidden",name:"_token",autocomplete:"off",value:t.$attrs.csrf_field},null,8,P),t.success?(d(),i("div",{key:0,class:"success-text",innerHTML:t.success},null,8,q)):u("",!0),t.errors?(d(),i("div",{key:1,class:"error-text",innerHTML:t.errors},null,8,G)):u("",!0),a(v,{ref:"googleCaptcha"},null,512),a(C,{ref:"name",modelValue:m.name,"onUpdate:modelValue":e[0]||(e[0]=f=>m.name=f),type:"text",name:"name",id:"comments-form-name"},{default:c(()=>e[4]||(e[4]=[l(" Введите ваше имя:")])),_:1},8,["modelValue"]),a(C,{ref:"email",modelValue:m.email,"onUpdate:modelValue":e[1]||(e[1]=f=>m.email=f),type:"text",name:"email",id:"comments-form-email"},{default:c(()=>e[5]||(e[5]=[l(" E-mail адрес:")])),_:1},8,["modelValue"]),a(x,{ref:"message",modelValue:m.message,"onUpdate:modelValue":e[2]||(e[2]=f=>m.message=f),name:"message",id:"comments-form-comment",rows:"20"},{default:c(()=>e[6]||(e[6]=[l(" Введите текст вашего сообщения:")])),_:1},8,["modelValue"]),s("div",J,[s("div",N,[a(S,{onClick:e[3]||(e[3]=_(f=>{h.saveComment()},["prevent"]))},{default:c(()=>e[7]||(e[7]=[l("Отправить")])),_:1})]),s("div",D,[s("div",null,[a(g,{href:"#",tabindex:"8",onclick:"return false;",title:"Отменить"},{default:c(()=>e[8]||(e[8]=[l("Отменить")])),_:1})])]),e[9]||(e[9]=s("div",{style:{clear:"both"}},null,-1))]),s("input",{type:"hidden",name:"object_id",value:o.post.id},null,8,O),e[10]||(e[10]=s("input",{type:"hidden",name:"object_group",value:"com_content"},null,-1))])],64)}const U=$(I,[["render",R]]),W={key:0,id:"jc"},Y={id:"comments"},K=["href"],Q={id:"comments-list",class:"comments-list"},X=["id"],Z={class:"rbox"},ee={class:"rbox_m"},te={class:"comment-box usertype-guest"},se={class:"comments-vote"},oe=["id"],ne=["onClick"],ae=["onClick"],ie={class:"comment-author"},de={class:"comment-date"},me=["id","innerHTML"],le={class:"comments-buttons"},re=["onClick"],ce={id:"comments-list-footer"},ue=["href"],fe={name:"Comments",props:["post"],data(){return{errors:"",success:"",regexpEmail:/^(?:[a-z0-9._]+(?:[-_.]?[a-z0-9._]+)?@[a-z0-9_.-]+(?:\.?[a-z0-9]+)?\.[a-z]{2,5})$/i,id:0,name:"",email:"",message:"",post_id:0,recaptcha_response:"",data:Object}},methods:{voteComment(t,e){let o={vote:e};return axios.patch(route("post.update",{id:t}),o).then(n=>{k.reload(),this.$refs.formAddComment.reloadCaptcha()}).catch(n=>{this.errors=n.data}),!1},async ajax(t){let e;return await axios.get(t).then(o=>{e=o.data}).catch(o=>{this.$data.errors+="<p>"+o.response.data.message+"</p>"}),e},async quoteComment(t){let e=await this.ajax(route("comment.id.ajax",t)),o=this.$refs.formAddComment.message.length==0?"":`
`;o+="[quote]"+e.text+`[/quote]
`,this.$refs.formAddComment.message+=o}}},he=Object.assign(fe,{setup(t){return(e,o)=>t.post.comments?(d(),i("div",W,[s("div",Y,[s("h4",null,[o[0]||(o[0]=l("Комментарии ")),s("a",{class:"rss",href:e.route("comment.rss",[t.post.category.slug,t.post.id,t.post.slug]),title:"RSS лента комментариев этой записи",target:"_blank"}," ",8,K)]),s("div",Q,[(d(!0),i(b,null,j(t.post.comments,(n,m)=>(d(),i("div",{class:"even",id:`comment-item-${n.id}`},[s("div",Z,[o[2]||(o[2]=s("div",{class:"rbox_tr"},[s("div",{class:"rbox_tl"},[s("div",{class:"rbox_t"}," ")])],-1)),s("div",ee,[s("div",te,[s("span",se,[s("span",{id:`comment-vote-holder-${n.id}`},[n.votes?(d(),i("a",{key:0,href:"#",class:"vote-good",title:"Хороший комментарий!",onClick:_(h=>{e.voteComment(n.id,1)},["prevent"])},null,8,ne)):u("",!0),n.votes?(d(),i("a",{key:1,href:"#",class:"vote-poor",title:"Плохой комментарий!",onClick:_(h=>{e.voteComment(n.id,-1)},["prevent"])},null,8,ae)):u("",!0),s("span",{class:B(n.voteClass)},p(n.voteCount),3)],8,oe)]),a(V(y),{class:"comment-anchor",href:`${e.route("item.name",[t.post.category.slug,t.post.id,t.post.slug])}#comment-${t.post.id}`,id:`comment-${t.post.id}`},{default:c(()=>[l("#"+p(m),1)]),_:2},1032,["href","id"]),s("span",ie,p(n.name),1),s("span",de,p(n.date),1),s("div",{class:"comment-body",id:`comment-body-${n.id}`,innerHTML:n.text},null,8,me),s("span",le,[s("a",{href:"#",onClick:_(h=>{e.quoteComment(n.id)},["prevent"])},"Цитировать",8,re)])]),o[1]||(o[1]=s("div",{class:"clear"},null,-1))]),o[3]||(o[3]=s("div",{class:"rbox_br"},[s("div",{class:"rbox_bl"},[s("div",{class:"rbox_b"}," ")])],-1))])],8,X))),256))]),s("div",ce,[s("a",{class:"rss",href:e.route("comment.rss",[t.post.category.slug,t.post.id,t.post.slug]),target:"_blank"},"RSS лента комментариев этой записи",8,ue)])]),a(U,{ref:"formAddComment",post:t.post},null,8,["post"])])):u("",!0)}}),pe={name:"Page",components:{Link:y,Comments:he},layout:L,props:["post"]},ge={key:0,class:"contentheading"},_e={class:"article-content"},ve=["innerHTML"],be=["innerHTML"];function Ce(t,e,o,n,m,h){const g=r("Link"),v=r("Comments");return o.post?(d(),i(b,{key:0},[e[0]||(e[0]=s("div",{class:"componentheading"},null,-1)),o.post.category?(d(),i("h2",ge,[a(g,{href:t.route("item.name",[o.post.category.slug,o.post.id,o.post.slug]),class:"contentpagetitle"},{default:c(()=>[l(p(o.post.title),1)]),_:1},8,["href"])])):u("",!0),s("div",_e,[s("span",{innerHTML:o.post.introtext},null,8,ve),s("span",{innerHTML:o.post.fulltext},null,8,be)]),a(v,{post:o.post},null,8,["post"])],64)):u("",!0)}const Se=$(pe,[["render",Ce]]);export{Se as default};
